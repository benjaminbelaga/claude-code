name: ðŸ” Debug Secrets

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout Code
      uses: actions/checkout@v4
    
    - name: ðŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: ðŸ“¦ Install CLASP
      run: npm install -g @google/clasp
    
    - name: ðŸ§ª Test Secrets Format
      run: |
        echo "Testing CLASPRC_JSON format..."
        echo '${{ secrets.CLASPRC_JSON }}' | jq . > /dev/null && echo "âœ… CLASPRC_JSON is valid JSON" || echo "âŒ CLASPRC_JSON is invalid JSON"
        
        echo "Testing CLASP_JSON format..."
        echo '${{ secrets.CLASP_JSON }}' | jq . > /dev/null && echo "âœ… CLASP_JSON is valid JSON" || echo "âŒ CLASP_JSON is invalid JSON"
    
    - name: ðŸ”‘ Create CLASP Credentials (Verbose)
      run: |
        echo "Creating .clasprc.json..."
        echo '${{ secrets.CLASPRC_JSON }}' > ~/.clasprc.json
        echo "File created with $(wc -c < ~/.clasprc.json) characters"
        
        echo "Creating .clasp.json..."
        echo '${{ secrets.CLASP_JSON }}' > .clasp.json
        echo "File created with $(wc -c < .clasp.json) characters"
        
        echo "Validating files..."
        ls -la ~/.clasprc.json .clasp.json
    
    - name: ðŸš€ Test CLASP Status
      run: |
        clasp login --status || echo "Login status check failed"